---
import Layout from '../../layouts/Layout.astro';
import Button from '../../components/ui/Button.astro';
import LanguageSelector from '../../components/ui/LanguageSelector.astro';
import PdfResumeLayout from '../../components/PdfResumeLayout.astro';
import { ArrowLeft } from 'lucide-react';

export async function getStaticPaths() {
  return [
    { params: { lang: 'en' } },
    { params: { lang: 'es' } }
  ];
}

// Get language from path parameter
const { lang } = Astro.params;

// Validate language and default to 'en'
const validLang = lang === 'es' ? 'es' : 'en';

// Load the appropriate language file
const enData = await import('../../content/resume/en.json');
const esData = await import('../../content/resume/es.json');
const data = validLang === 'es' ? esData.default : enData.default;

const locationText = validLang === 'es' ? 'Madrid, EspaÃ±a' : 'Madrid, Spain';
const jobConnector = validLang === 'es' ? 'en' : 'at';
---

<Layout title="Francisco NÃºÃ±ez Sierra - Resume">
  <div style="min-height: 100vh; background-color: white;" id="resume-container">
    <!-- Navigation Header -->
    <div id="resume-header" class="fixed top-0 left-0 right-0 z-10 p-2 sm:p-4 transition-transform duration-300 ease-in-out">
      <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2 sm:gap-4 max-w-7xl mx-auto">
        <!-- Back button - full width on mobile -->
        <Button
          variant="outline"
          className="bg-black/80 backdrop-blur-sm text-white border-2 border-black/60 font-black hover:bg-black/90 shadow-[2px_2px_0px_0px_rgba(0,0,0,0.6)] text-xs sm:text-sm lg:text-base px-2 sm:px-3 lg:px-4 py-1 sm:py-2 w-full sm:w-auto"
          onclick="window.location.href = '/'"
        >
          <ArrowLeft className="mr-1 lg:mr-2 w-3 h-3 lg:w-4 lg:h-4" />
          BACK TO WEBSITE
        </Button>
        
        <!-- Right side controls -->
        <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-2 sm:gap-4 w-full sm:w-auto">
          <Button
            variant="outline"
            className="bg-black/80 backdrop-blur-sm text-white border-2 border-black/60 font-black hover:bg-black/90 shadow-[2px_2px_0px_0px_rgba(0,0,0,0.6)] text-xs sm:text-sm lg:text-base px-2 sm:px-3 lg:px-4 py-1 sm:py-2 w-full sm:w-auto"
            onclick={`window.open('/resume-${validLang}.pdf', '_blank')`}
          >
            ðŸ“„ DOWNLOAD PDF
          </Button>
          <div class="flex justify-center sm:justify-start">
            <LanguageSelector currentLang={validLang} basePath="/resume" />
          </div>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const header = document.getElementById('resume-header');
        let lastScrollY = window.scrollY;
        let isHidden = false;

        function handleScroll() {
          const currentScrollY = window.scrollY;
          const isMobile = window.innerWidth < 640; // sm breakpoint
          
          if (isMobile) {
            if (currentScrollY > lastScrollY && currentScrollY > 100 && !isHidden) {
              // Scrolling down - hide header
              header.style.transform = 'translateY(-100%)';
              isHidden = true;
            } else if (currentScrollY < lastScrollY && isHidden) {
              // Scrolling up - show header
              header.style.transform = 'translateY(0)';
              isHidden = false;
            }
          } else {
            // Always show on desktop
            header.style.transform = 'translateY(0)';
            isHidden = false;
          }
          
          lastScrollY = currentScrollY;
        }

        // Throttle scroll events for better performance
        let scrollTimeout;
        window.addEventListener('scroll', function() {
          if (!scrollTimeout) {
            scrollTimeout = setTimeout(function() {
              handleScroll();
              scrollTimeout = null;
            }, 10);
          }
        });

        // Handle window resize
        window.addEventListener('resize', function() {
          const isMobile = window.innerWidth < 640;
          if (!isMobile) {
            header.style.transform = 'translateY(0)';
            isHidden = false;
          }
        });
      });
    </script>

    <!-- Resume Content -->
    <main class="pt-40 sm:pt-20 lg:pt-16 px-4 sm:px-8 pb-8" id="resume-content">
      <PdfResumeLayout 
        data={data} 
        locationText={locationText} 
        jobConnector={jobConnector} 
      />
    </main>
  </div>
</Layout>